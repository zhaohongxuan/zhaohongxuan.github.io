---
layout: post
title:  "使用花生壳搭建微信公众号的本地测试环境"
keywords: "wechat debug"
description: "使用花生壳搭建一个微信公众号的本地测试环境，方便和微信联调，不用重复向测试环境提交代码进行测试"
category: 微信开发
tags: wechat
---
前天用ngrok这个软件来代理转发微信请求本地微信环境的数据，但是二级域名每重启一次服务就会改变，实在是很不爽，以前
ngrok的二级域名也是免费的，可能用的人多了，就给整收费了吧，现在用新花生壳再一次搭建一个本地开发的微信环境，其实
这个严格来说也不是免费的，因为会收取一块钱的短信验证费用 ^_^。

###搭建步骤
####一、登录[花生壳官网](http://hsk.oray.com/)，没有注册的用户点击注册，注册新用户
![登录注册](http://i1.tietuku.com/ca7276ef94614343.png)

####二、点击`管理中心`，进入我的花生壳，点击`添加帐号`，添加新的帐号
![添加帐号](http://i1.tietuku.com/8fcc5c6fa0303f8c.png)
应该会有一个默认帐号，点击`默认帐号`，会出现域名列表，如果没有域名的话，点击`添加域名`，创建一个花生壳的`二级域名`
![添加域名](http://i1.tietuku.com/007820205eff83f8.png)
####三、登录[花生壳官网](http://hsk.oray.com/)下载新花生壳
![下载](http://i1.tietuku.com/21226425440dd5b8.jpg)
####四、安装花生壳
双击下载的安装包，安装到本机上
![安装配置](http://i1.tietuku.com/c92b1be2c6616b92.png)

####五、登录上新花生壳客户端，双击选中的账户
输入注册好的用户和密码登录上新花生壳客户端
![开启服务](http://i1.tietuku.com/1e0c8a4e9c08483a.png)

####六、在弹出的窗口中将内网映射选项打开，那个外网访问地址就是在微信后台配置的接口地址
如果是首次使用的话，内网映射应该是打不开的，需要激活才能使用，激活步骤转到步骤七
![配置接口信息](http://i1.tietuku.com/2172fc5eb39d7a96.png)

####七、打开 http://www.oray.com/activity/140902/ 可以通过三种方式开通内网映射
在这里选择短信激活，会收取一块钱费用，如果长时间没有收到验证码，也可以通过支付宝支付一块钱激活。
激活之后就可以在打开新花生壳上的内网映射选项应该可以打开了，如果打不开的情况，重启一下新花生壳就能登上了

![激活内网映射权限](http://i1.tietuku.com/f122a2a40782e5e6.png)

####八、进入微信公众平台后台接口配置信息中，配置服务器URL
![配置服务器URL](http://i1.tietuku.com/bc89b32d68437d27.png)
####九、本地启动Tomcat服务器，微信发送一个消息，控制台就会打印微信发过来的消息
在微信客户端发送了一个`赵小轩`的消息，在本地控制台就会打印微信推送过来的消息，以后就可以实时和微信联调了，也就是微信开发本地环境搭建成功了。
![和微信服务器联通](http://i3.tietuku.com/cd0dda088c781086.png)



